<!doctype html>
<html>
<head>
  <title>Nano-particle Exposure Tool - Compute Air Change Rate</title>
  <script type="text/javascript" src="../contam/units_1.js"></script>
  <script>
    function do_onload()
    {
      var SupplyInput = document.getElementById("SupplyInput");
      var ReturnInput = document.getElementById("ReturnInput");
      SupplyInput.baseValue = 1;
      ReturnInput.baseValue = 1;
      window.units = 0;
      
      var flowUnits = document.getElementById("flowUnits");
      flowUnits.innerHTML = CONTAM.Units.Strings.Flow[window.units];

      changeInput();
    }
    
    function changeUnits(combo)
    {
      var UnitsCombo = document.getElementById("UnitsCombo");
      var units = window.units = UnitsCombo.selectedIndex;
      var SupplyInput = document.getElementById("SupplyInput");
      var ReturnInput = document.getElementById("ReturnInput");
      
      SupplyInput.value = CONTAM.Units.FlowConvert(SupplyInput.baseValue, units, 0);
      ReturnInput.value = CONTAM.Units.FlowConvert(ReturnInput.baseValue, units, 0);
      
      var resultantOA = document.getElementById("resultantOA");
      resultantOA.textContent = CONTAM.Units.FlowConvert(oa_flow, units, 0);
      
      var flowUnits = document.getElementById("volumeUnits");
      flowUnits.innerHTML = CONTAM.Units.Strings.Flow[units];
    }
    
    function changeInput()
    {
      var Nano = window.parent.Nano;
      var SupplyInput = document.getElementById("SupplyInput");
      var ReturnInput = document.getElementById("ReturnInput");
      var POAInput = document.getElementById("POAInput");
      var supplyFromUser = parseFloat(SupplyInput.value);
      var returnFromUser = parseFloat(ReturnInput.value);
      var POAFromUser = parseFloat(POAInput.value);
      var units = window.units;
      SupplyInput.baseValue = CONTAM.Units.FlowConvert(supplyFromUser, units, 1);
      ReturnInput.baseValue = CONTAM.Units.FlowConvert(returnFromUser, units, 1);
      var supply_flow = SupplyInput.baseValue;
      var return_flow = ReturnInput.baseValue;
      var poa = POAFromUser;

      //get volume from parent
      var BuildingVolumeInput = window.parent.document.getElementById("BuildingVolumeInput");
      vol = BuildingVolumeInput.baseValue;

      oa_flow = supply_flow * (poa / 100);
      ach = Nano.kg_per_s_to_ACH(oa_flow, vol, 0, 293);

      var resultantOA = document.getElementById("resultantOA");
      var resultantACH = document.getElementById("resultantACH");

      resultantOA.textContent = CONTAM.Units.FlowConvert(oa_flow, units, 1);
      resultantACH.textContent = ach;
    }

    function ok_button()
    {
      var Nano = window.parent.Nano;
      Nano.CloseDialog(true);
    }

    function cancel_button()
    {
      var Nano = window.parent.Nano;
      Nano.CloseDialog(false);
    }
  </script>
  <style type="text/css">
    @import url("../../index.css");
    .inblock { display: inline-block; }
    .unit { display: inline-block; white-space:nowrap; min-width: 360px; padding:5px; }
    .col { min-width: 85px; }
  </style>
</head>
<body onload="do_onload();" style="background: white;">
  <div style="display:flex; flex-flow:row; margin: 1em;">
    <div style="display:flex; flex-flow:column;">
      <div class="section">
        <div class="unit">
          <div class="inblock col">Supply Flow</div>
          <input type="number" step="any" min="0" value ="1"
          id="SupplyInput" onchange=" changeInput();">
        </div>
        <div class="unit">
          <div class="inblock col">Return Flow</div>
          <input type="number" step="any" min="0" value ="1"
          id="ReturnInput" onchange=" changeInput();">
          <select id="UnitsCombo" onchange="changeUnits(this);">
            <option>kg/s</option>
            <option>scfm</option>
            <option>sL/s</option>
            <option>sm&sup3;/s</option>
            <option>sm&sup3;/h</option>
            <option>lb/s</option>
            <option>sft&sup3;/h</option>
            <option>sL/min</option>
            <option>kg/h</option>
          </select>
        </div>
        <div class="unit">
          <div class="inblock col">Percent Outdoor Air</div>
          <input type="number" step="any" min="0" value ="1"
          id="POAInput" onchange=" changeInput();">
          <span>%</span>
        </div>
      </div>
      <div class="section">
        <div class="unit">
          <div class="inblock col">OA Flow</div>
          <div id="resultantOA" class="inblock" style="border:solid;min-width:200px;">&nbsp;</div>
          <div id="flowUnits" class="inblock">kg/s</div>
        </div>
        <div class="unit">
          <div class="inblock col">Air Change Rate</div>
          <div id="resultantACH" class="inblock" style="border:solid;min-width:200px;">&nbsp;</div>
          <div class="inblock">h<sup>-1</sup></div>
        </div>
      </div>
    </div>
  </div>
  <div style="margin-left:2em;">
    <input value="OK" type="button" onclick="ok_button();">
    <input value="Cancel" type="button" onclick="cancel_button();">
  </div>
</body>
</html>